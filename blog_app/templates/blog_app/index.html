{% extends "base.html" %}
{% load static %}
{% block title %} TOMOZART {% endblock %}

{% block content %}

<style>
  .product-carousel-wrap{
    border: 2px solid rgba(0,0,0,.35);
    border-radius: 16px;
    padding: 20px;
    background: linear-gradient(
        180deg,
        rgba(60,60,60,0.95),
        rgba(45,45,45,0.95)
    );
  }

  /* Keep cards unchanged */
  .product-card{
    height: 100%;
    border-radius: 20px;
    overflow: hidden;
    transition: transform .25s ease, box-shadow .25s ease;
    background-color: transparent;
  }

  .product-card-img{
    height: 220px;
    width: 100%;
    object-fit: cover;
    display: block;
  }

  /* Match card text area to site base background */
  .product-card .card-body{
    background-color: #f8f9fa;   /* Bootstrap light background */
    border-top: 1px solid rgba(0,0,0,.08);
  }

  .product-carousel-wrap h3{
    color: #ffffff;
  }
</style>


<div class="container py-5">

  <div class="text-center mb-4">
    <h2 class="mb-3">
      Welcome {% if user.is_authenticated %}{{ user.username }}{% endif %},
      to Thomas A Overment's (AKA Tomo's) Art Gallery
    </h2>

    <p class="text-muted">
      I am Tomo, and I am thrilled to share my world of art with you.
      Here you will find a collection of my work, ranging from vibrant
      spray paintings to mixed media canvas pieces.
    </p>

    <hr class="mt-4">
  </div>

</div>


{% if user.is_authenticated %}
  <div class="row">
    <div class="col text-center">
      <div class="alert alert-success" role="alert">
        Welcome {{ user.username }}.
      </div>
    </div>
  </div>
  <br>
{% else %}
  <div class="row">
    <div class="col text-center">
      <div class="alert alert-warning" role="alert">
        You are not logged in. Please log in or register to enjoy full access to the gallery and additional features.
      </div>
    </div>
  </div>
  <br>
{% endif %}

{% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  <br>
{% endif %}

<!-- ========================= -->
<!-- PRODUCT CAROUSEL (3 per slide) -->
<!-- ========================= -->
{% if products %}
<div class="container my-4">
  <div class="product-carousel-wrap">
    <h3 class="text-center mb-3">Featured Products</h3>

    <div id="productCarousel"
         class="carousel slide"
         data-bs-ride="carousel"
         data-bs-interval="3500"
         data-bs-pause="hover"
         data-bs-touch="true">

      <div class="carousel-inner">

        {% for product in products %}
          {% if forloop.counter0|divisibleby:3 %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <div class="row g-3 justify-content-center">
          {% endif %}

                <div class="col-12 col-md-4">
                  <div class="card product-card h-100 shadow-sm">

                    <!-- Clicking image goes to product detail -->
                    <a href="{% url 'store:product_detail' product.id %}" class="text-decoration-none">
                      {% if product.image %}
                        <img src="{{ product.image.url }}"
                             class="card-img-top product-card-img"
                             alt="{{ product.name }}">
                      {% else %}
                        <img src="https://dummyimage.com/600x400/dee2e6/6c757d.jpg"
                             class="card-img-top product-card-img"
                             alt="{{ product.name }}">
                      {% endif %}
                    </a>

                    <div class="card-body text-center">
                      <h6 class="card-title mb-1">{{ product.name }}</h6>
                      {% if product.price %}
                        <p class="card-text mb-2">Â£{{ product.price }}</p>
                      {% endif %}
                      <a href="{% url 'store:product_detail' product.id %}" class="btn btn-sm btn-outline-dark">
                        View
                      </a>
                    </div>
                  </div>
                </div>

          {% if forloop.counter0|add:1|divisibleby:3 or forloop.last %}
              </div>
            </div>
          {% endif %}
        {% endfor %}

      </div>

      <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>

      <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>

    </div>
  </div>
</div>
{% endif %}

<hr>

<!-- ========================= -->
<!-- BLOG POSTS -->
<!-- ========================= -->
<div class="row">
  {% for post in object_list %}
    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-body">
          <div class="image-container">
            <div class="image-flash">
              <p class="author">Author: {{ post.author }}</p>
            </div>
          </div>

          <a href="{% url 'blog:post_detail' post.slug %}" class="post-link">
            <h2 class="card-title">{{ post.title }}</h2>
          </a>

          <hr>

          <p class="card-text text-muted h6">{{ post.created_on }}</p>
          <p class="card-text">{{ post.content|safe }}</p>

          {% if post.post_image %}
            <img src="{{ post.post_image.url }}" class="img-fluid" alt="{{ post.title }}">
          {% endif %}

          <!-- Centered buttons: SAME style as Featured Product buttons -->
          {% if user.is_authenticated %}
            {% if user == post.author or user.is_staff %}
              <div class="text-center mt-3">
                <a href="{% url 'blog:update_post' post.pk %}"
                   class="btn btn-sm btn-outline-dark me-2">
                  Edit
                </a>

                <a href="{% url 'blog:delete_post' post.id %}"
                   class="btn btn-sm btn-outline-dark">
                  Delete
                </a>
              </div>
            {% endif %}
          {% endif %}

        </div>
      </div>
    </div>

    {% if forloop.counter|divisibleby:3 %}
      </div>
      <div class="row">
    {% endif %}
  {% endfor %}
</div>

{% endblock %}
